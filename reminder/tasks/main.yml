---
- name: Ensure Git is installed
  apt:
    name: git
    state: present
  notify: Удаляем папку с файлами git  

- name: Clone or Update Repository
  git:
    repo: "{{ github_repo }}"
    dest: "{{ deploy_dir }}"
    version: "{{ git_branch }}"
    force: no

- name: Копируем файлы в целевую директорию
  shell:
    cp "{{ item.src }}" "{{ item.dest }}"
  with_items:
    - { src: "{{ deploy_dir }}/reminder.py", dest: "{{dest_dir}}" }
    - { src: "{{ deploy_dir }}/reminder_utils.py", dest: "{{dest_dir}}" }
  notify: Удаляем папку с файлами git

- name: Stop reminder service
  systemd:
    name: reminder
    state: stopped

- name: Start reminder service
  systemd:
    name: reminder
    enabled: yes
    state: started
  register: service_status

- name: Verify service is active and running
  assert:
    that:
      - service_status.status.ActiveState == 'active'
      - service_status.status.SubState == 'running'
    msg: "Service reminder is not running. Current status: {{ service_status.status.ActiveState }}"
# tasks file for reminder
